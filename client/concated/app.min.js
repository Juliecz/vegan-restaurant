function loginPost(){$(document).ready(function(){var a,b;$("#submit").click(function(){a=$("#username").val(),b=$("#password").val(),$.post("http://localhost:3000/admin",{user:a,password:b},function(a){})})})}function initialize(){var a=(new google.maps.DirectionsService,new google.maps.DirectionsRenderer),b=new google.maps.LatLng(50.0311522,14.4885689),c={zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,center:b},d=new google.maps.Map(document.getElementById("map"),c),e=new google.maps.Marker({position:b,map:d,title:"Veganska restaurace",animation:google.maps.Animation.DROP});a.setMap(d,e)}function FindAll(a){Drink.find(function(b,c){b&&a.send(b),a.json(c)})}function findAllFunc(a){Menu.find(function(b,c){b&&a.send(b),a.json(c)})}function randomPassword(){for(var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",b="",c=7,d=0;c>d;d++){var e=Math.floor(Math.random()*a.length);b+=a.substring(e,e+1)}return b}angular.module("veganapp.admin").controller("dailyMenuCtrl",["$scope","$state","$stateParams","$window","dailyMenuFactory",function(a,b,c,d,e){a.day=["Pondělí","Úterý","Středa","Čtvrtek","Pátek"],a.dayObj=[],null===c.activeTab?a.activeTab="pondeli":a.activeTab=c.activeTab,a.actions={"new":"Pridat nove jidlo",edit:"Upravit jidlo"},a.days=[{id:"pondeli",name:"Pondělí"},{id:"utery",name:"Úterý"},{id:"streda",name:"Středa"},{id:"ctvrtek",name:"Čtvrtek"},{id:"patek",name:"Pátek"}],e.getDay().success(function(b,c){a.datum=b,console.log("Status getday: ",c)}),e.getDailyMenu().success(function(b,c){if(a.data=b,a.data&&a.datum)for(var d=0;d<a.day.length;d++)a.dayObj.push({name:a.datum[d],text:a.day[d]})}),e.getSort().success(function(b,c){a.typ=b}),a.setAction=function(d,f){c.action=d,c.id=f;var g={};"new"==c.action?(g={action:c.action,actionName:a.actions["new"],id:f,object:{},menuType:"daily",day:a.activeTab},c.actionName=a.actions["new"],b.go("admin.edit",g)):"edit"==c.action?e.getById(f).success(function(d,e){g={action:c.action,actionName:a.actions.edit,id:f,object:d,menuType:"daily"},b.go("admin.edit/:id",g)}):"delete"==c.action&&(g={action:c.action,actionName:"delete",id:c.id},e.removeFood(g.id),e.getDailyMenu().success(function(b,c){if(a.data=b,a.data&&a.datum)for(var d=0;d<a.day.length;d++)a.dayObj.push({name:a.datum[d],text:a.day[d]})}))},a.setTab=function(b){a.activeTab=b}}]),angular.module("veganapp.admin").controller("editCtrl",["$scope","$state","$stateParams","menuFactory","dailyMenuFactory","drinkMenu","userFactory",function(a,b,c,d,e,f,g){switch(a.typMenu=["Staly jídelní lístek","Polední menu","Nápojový lístek"],a.typMenuId=["menu","daily","drink","user"],a.role=["admin","employee"],a.typMenuSelected=c.action,c.menuType){case"menu":"new"==c.action?a.action="Přidat nové jídlo do jídelního lístku":"edit"==c.action&&(a.action="Upravit jídlo");break;case"daily":"new"==c.action?a.action="Přidat nové jídlo do poledního menu":"edit"==c.action&&(a.action="Upravit jídlo v poledním menu");break;case"drink":"new"==c.action?a.action="Přidat nový nápoj":"edit"==c.action&&(a.action="Upravit nápoj");break;case"user":"new"==c.action?a.action="Nový uživatel":"edit"==c.action&&(a.action="Úprava osobních údajů");break;default:b.go("admin.menu")}e.getDay().success(function(b,c){a.den=b}),d.getFood().success(function(b,c){a.dataMenu=b}),d.getSort().success(function(b){a.trida=b}),d.getTyp().success(function(b){a.typ=b}),f.getSort().success(function(b){a.sortDrink=b}),"edit"==c.action?"daily"==c.menuType||"menu"==c.menuType?(a.formData={jmeno:c.object.foodName,popis:c.object.foodDescription,typ:c.object.foodType,trida:c.object.foodSort,cena:c.object.price},"menu"==c.menuType?a.formData.typMenu=a.typMenuId[0]:"daily"==c.menuType&&(a.formData.typMenu=a.typMenuId[1],a.formData.den=c.object.day)):"drink"==c.menuType?f.getById(c.id).success(function(b){a.formData={jmeno:b.drinkName,popis:b.drinkDescription,trida:b.drinkSort,cena:b.price,typMenu:a.typMenuId[2],objem:b.volume}}):"user"==c.menuType&&g.getUserById(c.id).success(function(b){a.formData={uzivJm:b.username,jm:b.name,prijm:b.surname,role:b.role,phone:b.phone,email:b.email,typMenu:"user"}}):"new"==c.action&&(a.formData={jmeno:"",popis:"",typ:"",trida:"",cena:""},"menu"==c.menuType?a.formData.typMenu=a.typMenuId[0]:"daily"==c.menuType?(a.formData.typMenu=a.typMenuId[1],a.formData.den=c.day):"drink"==c.menuType?a.formData.typMenu=a.typMenuId[2]:"user"==c.menuType&&(a.formData.typMenu="user")),a.sendPost=function(){"new"==c.action?a.createFood(a.formData):"edit"==c.action&&a.editFood(a.formData)},a.createFood=function(a){if(a)switch(c.menuType){case"menu":d.createFood(a).success(function(a){}),b.go("admin.menu",{activeTab:"jidelni"});break;case"daily":e.createFood(a).success(function(a){}),b.go("admin.dailyMenu",{activeTab:a.den});break;case"drink":f.createDrink(a).success(function(a){}),b.go("admin.menu",{activeTab:"napojovy"});break;case"user":g.createUser(a).success(function(a){}),b.go("admin.users")}},a.editFood=function(a){if(a)switch(c.menuType){case"menu":d.updateFood(c.id,a).success(function(a){}),b.go("admin.menu",{activeTab:"jidelni"});break;case"daily":e.editFood(a,c.id).success(function(a){}),b.go("admin.dailyMenu",{activeTab:a.den});break;case"drink":f.updateDrink(a,c.id).success(function(a){}),b.go("admin.menu",{activeTab:"napojovy"});break;case"user":g.updateUser(c.id,a).success(function(a){}),b.go("admin.users")}}}]),angular.module("veganapp.admin").controller("homeCtrlA",["$scope","$http","$stateParams","authProvider","reservationFactory","userFactory",function(a,b,c,d,e,f){Date.prototype.ddmmyyyy=function(){var a=this.getDate(),b=parseInt(this.getMonth())+1,c=this.getFullYear();return 10>b&&(b="0"+b),10>a&&(a="0"+a),[a,".",b,".",c].join("")},a.firstDay=function(){var a=new Date,b=a.getDay(),c=a.getDate()-b+(0===b?-6:1);return new Date(a.setDate(c))},a.dis=!0,a.myInfo=function(){d.isLoggedIn().then(function(b){f.getUserById(b.data).success(function(b){a.me={id:b._id,uzivJm:b.username,jm:b.name,prijm:b.surname,role:b.role,email:b.email,phone:b.phone,emailM:b.emailMessage,password:b.password,emailMTmp:b.emailMessage}})})},a.myInfo(),a.send=function(b,c){if((""!==a.me.passwStare||""!==a.me.passwNove)&&a.me.passwStare&&a.me.passwNove){if(a.me.passwStare!==a.me.password)return a.message="* Zadejte správné heslo",0;a.me.password=a.me.passwNove}a.dis||(f.updateUser(b,c).success(function(b,c){a.dis=!0}),a.me.passwStare="",a.me.passwNove="",a.message="")},a.navstevy=0,a.rezervace=0,e.getForDay((new Date).ddmmyyyy()).success(function(b){a.rezervace=b.length}),a.zrusit=function(){a.message="",a.me.passwStare="",a.me.passwNove="",a.dis=!0,a.me.emailMTmp=a.me.emailM}}]),angular.module("veganapp.admin").controller("loginCtrl",["$scope","$state","$http","$rootScope","$location","authProvider",function(a,b,c,d,e,f){a.user={},a.login=function(){f.login(a.user.username,a.user.password).then(function(a){b.go("admin")})["catch"](function(){a.outputData="Zadejte spravne udaje"})}}]),angular.module("veganapp.admin").controller("menuCtrl",["$scope","$state","$stateParams","menuFactory","drinkMenu","userFactory","authProvider",function(a,b,c,d,e,f,g){g.isLoggedIn().then(function(b){f.getUserById(b.data).success(function(b){a.me=b})}),null===c.activeTab?a.activeTab="jidelni":a.activeTab=c.activeTab,a.setTab=function(b){a.activeTab=b,"jidelni"==a.activeTab?a.actions={"new":"Přidat nové jídlo",edit:"Upravit jídlo"}:a.actions={"new":"Přidat nový nápoj",edit:"Upravit nápoj"}},"jidelni"==a.activeTab?a.actions={"new":"Přidat nové jídlo",edit:"Upravit jídlo"}:a.actions={"new":"Přidat nový nápoj",edit:"Upravit nápoj"},a.dataMenu={},a.typ={},a.trida={},a.tridaVar=[],d.getFood().success(function(b,c){a.dataMenu=b}),d.getTyp().success(function(b,c){a.typ=b}),d.getSort().success(function(b,c){if(a.trida=b,a.trida)for(var d=0;d<a.trida.length;d++)"predkrm"==a.trida[d]?a.tridaVar.push({name:"predkrm",text:"Předkrmy"}):"hlavni"==a.trida[d]?a.tridaVar.push({name:"hlavni",text:"Hlavní chody"}):"salat"==a.trida[d]?a.tridaVar.push({name:"salat",text:"Saláty"}):"dezert"==a.trida[d]&&a.tridaVar.push({name:"dezert",text:"Dezerty"})}),e.getDrinks().success(function(b){a.drinks=b}),e.getSort().success(function(b){a.sortD=b}),a.setAction=function(f,g,h){c.action=f,c.id=g;var i={};if("new"==c.action)i={action:c.action,actionName:a.actions["new"],id:c.id,object:{},menuType:h},c.actionName=a.actions["new"],b.go("admin.edit",i);else if("edit"==c.action){for(var j=0;j<a.dataMenu.length;j++)if(a.dataMenu[j]._id==c.id){a.editFoodObj=a.dataMenu[j];break}i={action:c.action,actionName:a.actions.edit,id:c.id,object:a.editFoodObj,menuType:h},b.go("admin.edit/:id",i)}else"delete"==c.action&&("menu"===h?(i={action:c.action,actionName:"delete",id:c.id},d.removeFood(i.id),d.getFood().success(function(b,c){a.dataMenu=b})):"drink"==h&&(e.removeDrink(g),e.getDrinks().success(function(b){a.drinks=b})))}}]),angular.module("veganapp.admin").controller("reservationCtrl",["$scope","tablesFactory","reservationFactory",function(a,b,c){a.setTab=function(b){a.activeTab=b},Date.prototype.ddmmyyyy=function(){var a=this.getDate(),b=parseInt(this.getMonth())+1,c=this.getFullYear();return 10>b&&(b="0"+b),10>a&&(a="0"+a),[a,".",b,".",c].join("")},Date.prototype.hhmm=function(){var a=this.getHours(),b=this.getMinutes();return 10>b?[a,":0",b].join(""):[a,":",b].join("")},a.tableObj=[],a.Filter={ByDate:"",validDate:"",ByText:""},a.today=new Date,a.activeTab=a.today.getDate(),a.getTables=function(){b.getTables().success(function(b){a.tables=b;for(var c=0;c<b.length;c++)a.tableObj.push({table:b[c],checked:!1})})},a.showReservations=function(b){if(""!==a.Filter.ByDate){var c=a.Filter.ByDate.split("."),d=new Date(c[2],c[1]-1,c[0]);new Date(b.startDate.getFullYear(),b.startDate.getMonth(),b.startDate.getDate());return b.startDate.getFullYear()===d.getFullYear()&&b.startDate.getMonth()==d.getMonth()&&b.startDate.getDate()===d.getDate()}if(""===a.Filter.validDate){if(""===a.Filter.ByDate)return b.startDate>=new Date}else if("prev"===a.Filter.validDate)return b.startDate<new Date},a.getTables(),a.allReservations=function(){a.reservations=[],c.getReservations().success(function(b){for(var c=0;c<b.length;c++)if(a.reservations.push({_id:b[c]._id,name:b[c].name,surname:b[c].surname,table:b[c].table,startDate:new Date(b[c].startDate),endDate:new Date(b[c].endDate),phone:b[c].phone,email:b[c].email}),a.tableObj.length>0){for(var d=0;d<a.tableObj.length;d++)if(a.tableObj[d].table._id===b[c].table){a.reservations[c].tableNum=a.tableObj[d].table.name;break}}else{a.getTables();for(var e=0;e<a.tableObj.length;e++)if(a.tableObj[e].table._id===b[c].table){a.reservations[c].tableNum=a.tableObj[e].table.name;break}}})},a.allReservations(),a.updateTables=function(a,b){angular.forEach(b,function(b,c){a!=c&&(b.checked=!1)})},a.changeTime=function(a){(!a.endTime||parseInt(a.endTime)<=parseInt(a.startTime))&&(a.endTime=(parseInt(a.startTime)+1).toString())},a.checkendTime=function(a){var b=parseInt(a.startTime),c=parseInt(a.endTime);b>=c&&(b=c-1,a.startTime=b.toString())},a.editRes=function(b){for(var c=0;c<a.reservations.length;c++)if(a.reservations[c]._id==b){a.upravit=a.reservations[c],a.upravit.datum=a.reservations[c].startDate.ddmmyyyy();break}},a.onclickDate=function(b,c,d){a.today=new Date(d,c,b),a.selected=b,a.showSecondTable=!0,a.firstDayInWeek=a.Calendar.weekStartDate(a.today),a.lastDayInWeek.setDate(a.firstDayInWeek.getDate()+6)},a.dnes=function(a,b,c){var d=new Date;return d.getDate()===a&&d.getMonth()===b&&d.getFullYear()===c?d.getDate():-1},a.deleteReservation=function(b){c.deleteReservation(b).success(function(a){a&&console.log(a)}),a.allReservations()}}]),angular.module("veganapp.admin").controller("usersCtrl",["$scope","$state","$stateParams","$window","menuFactory","dailyMenuFactory","userFactory","authProvider",function(a,b,c,d,e,f,g,h){h.isLoggedIn().then(function(c){g.getUserById(c.data).success(function(c){a.me=c,"employee"===c.role&&b.go("admin.me")})}),g.getAllUsers().success(function(b){a.users=b}),a.setAction=function(c,d,e){var f={};"user"===e&&("delete"===c?(g.deleteUser(d),g.getAllUsers().success(function(b){a.users=b})):"edit"===c?(f={action:c,id:d,menuType:e},b.go("admin.edit/:id",f)):"new"===c&&(f={action:c,id:d,menuType:e},b.go("admin.edit",f)))}}]),angular.module("veganapp.admin").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("admin",{url:"/admin",views:{main:{templateUrl:"/views/admin/content.html",controller:"headCtrlA"}},resolve:{loggedInResolve:function(a,b,c){a.isLoggedIn().then(function(a){""!==a.data&&"401"!==a.data?"admin"===c.$state.current.name&&b.go("admin.home"):b.go("login")},function(){b.go("login")})}},abstact:!0}).state("admin.home",{url:"/home",views:{admin:{templateUrl:"/views/admin/home.html",controller:"homeCtrlA"}}}).state("admin.users",{url:"/users",views:{admin:{templateUrl:"/views/admin/users.html",controller:"usersCtrl"}}}).state("admin.menu",{url:"/menu",views:{admin:{templateUrl:"/views/admin/menu.html",controller:"menuCtrl"}},params:{activeTab:null}}).state("admin.dailyMenu",{url:"/dailyMenu",views:{admin:{templateUrl:"/views/admin/dailyMenu.html",controller:"dailyMenuCtrl"}},params:{activeTab:null}}).state("admin.reservation",{url:"/reservation",views:{admin:{templateUrl:"/views/admin/reservation.html",controller:"reservationCtrl"}}}).state("admin.edit",{url:"/edit",views:{admin:{templateUrl:"/views/admin/edit.html",controller:"editCtrl"}},params:{action:null,actionName:null,id:null,object:{},menuType:null,day:null}}).state("admin.edit/:id",{url:"/edit/:id",views:{admin:{templateUrl:"/views/admin/edit.html",controller:"editCtrl"}},params:{action:null,actionName:null,id:null,object:{},menuType:null}}).state("login",{url:"/login",views:{main:{templateUrl:"/views/admin/login.html",controller:"loginCtrl"}},resolve:{loggedInResolve:function(a,b){a.isLoggedIn().then(function(a){console.log("resolve is running: ",a.data),""!==a.data&&"0"!==a.data?b.go("admin.home"):b.go("login")},function(){b.go("login")})}}})}]).run(["$state","$rootScope","$location","authProvider",function(a,b,c,d){}]).controller("headCtrlA",["$scope","$state","$stateParams","$location","$window","$document","authProvider","userFactory",function(a,b,c,d,e,f,g,h){a.c="home",a.logout=function(){g.logout().then(function(){d.url("/home")})},g.isLoggedIn().then(function(b){h.getUserById(b.data).success(function(b){console.log("Data from server: ",b),a.uzivatel=b})}),a.winSize=e.innerWidth,a.resizeWin=function(){e.innerWidth<768?(a.showLeftMenu=!1,a.classSmallScreen="smallScreen"):(a.showLeftMenu=!0,a.classSmallScreen="")},a.resizeWin(),$(window).resize(function(){a.$apply(function(){a.resizeWin(),a.winSize=e.innerWidth})}),a.showHideLeftMenu=function(){e.innerWidth<768&&(a.showLeftMenu?a.showLeftMenu=!1:a.showLeftMenu=!0,"smallScreen"===a.classSmallScreen?a.classSmallScreen="":a.classSmallScreen="smallScreen")},a.clickSection=function(){e.innerWidth<768&&(a.showLeftMenu=!1,a.classSmallScreen="smallScreen")}}]),angular.module("veganapp.public",["veganapp.system"]),angular.module("veganapp.admin",["veganapp.system"]);var myApp=angular.module("veganapp",["veganapp.public","veganapp.admin","veganapp.system"]);myApp.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("root",{views:{main:{controller:["$state","$injector",function(a,b){}]}}}),b.otherwise("/home")}]).controller("contentCtrl",function(a,b,c){c.go("public.home")}).run(["$location","$state",function(a,b){}]),angular.module("veganapp.public").controller("contactCtrl",function(a){}),angular.module("veganapp.public").controller("homeCtrl",function(a){a.today=new Date,a.week=[{day:"Ponděli",id:1,from:"08:00",to:"23:00"},{day:"Útery",id:2,from:"08:00",to:"23:00"},{day:"Středa",id:3,from:"08:00",to:"23:00"},{day:"Čtvrtek",id:4,from:"08:00",to:"23:00"},{day:"Pátek",id:5,from:"08:00",to:"23:00"},{day:"Sobota",id:6,from:"08:00",to:"23:00"},{day:"Neděle",id:0,from:"08:00",to:"23:00"}]}),angular.module("veganapp.public").controller("menuCtrlP",["$scope","$http","menuFactory","dailyMenuFactory","drinkMenu",function(a,b,c,d,e){switch(a.today=(new Date).getDay(),0===a.today||6===a.today?a.vikend=!0:a.vikend=!1,a.tridaVar=[],a.poledni=[],a.vikend="Pro dnešní den není žádné polední menu.",a.today){case 1:a.todayStr="pondeli";break;case 2:a.todayStr="utery";break;case 3:a.todayStr="streda";break;case 4:a.todayStr="ctvrtek";break;case 5:a.todayStr="patek"}a.tyden=[{name:"pondeli",text:"Pondělí"},{name:"utery",text:"Úterý"},{name:"streda",text:"Středa"},{name:"ctvrtek",text:"Čtvrtek"},{name:"patek",text:"Pátek"}],a.tridaDaily=[{name:"polevka",text:"Polévka"},{name:"hlavni",text:"Hlavní chody"}],c.getFood().success(function(b,c){a.data=b}),d.getDailyMenu().success(function(b,c){a.celePoledni=b;for(var d=0;d<b.length;d++)b[d].day===a.todayStr&&(console.log("Cislo: ",d," object: ",b[d]),a.poledni.push(b[d]));a.poledni.length<1&&console.log(a.vikend)}),c.getSort().success(function(b,c){if(a.trida=b,a.amount=a.trida.length,a.trida)for(var d=0;d<a.trida.length;d++)"predkrm"==a.trida[d]?a.tridaVar.push({name:"predkrm",text:"Předkrmy"}):"hlavni"==a.trida[d]?a.tridaVar.push({name:"hlavni",text:"Hlavní chody"}):"salat"==a.trida[d]?a.tridaVar.push({name:"salat",text:"Saláty"}):"dezert"==a.trida[d]&&a.tridaVar.push({name:"dezert",text:"Dezerty"})}),e.getDrinks().success(function(b){a.napojovy=b}),e.getSort().success(function(b){a.sortD=[{name:b[0],text:"Čaj"},{name:b[1],text:"Káva"},{name:b[2],text:"Fresh"},{name:b[3],text:"Ostatní"}]}),a.tabs=[{title:"Polední menu",template:"poledni"},{title:"Jídelní lístek",template:"jidelni"},{title:"Nápojový lístek",template:"napojovy"}],a.activeTab="jidelni",a.setTab=function(b){a.activeTab=b}}]),angular.module("veganapp.public").controller("tablesCtrl",["$scope","tablesFactory","reservationFactory",function(a,c,d){if(a.tableObj=[],a.prijataRezervace=!1,a.availability=[],c.getTables().success(function(b,c){for(var d=0;d<b.length;d++)a.availability.push({table:b[d],free:!0,checked:!1})}),Date.prototype.ddmmyyyy=function(){var a=this.getDate(),b=parseInt(this.getMonth())+1,c=this.getFullYear();return 10>b&&(b="0"+b),10>a&&(a="0"+a),[a,".",b,".",c].join("")},a.today=new Date,a.datum=new Date,a.reservation={day:a.today.getDate(),month:a.today.getMonth(),year:a.today.getFullYear(),datum:a.today.ddmmyyyy()},(new Date).getHours()>=21&&(new Date).getMinutes()>30){var e=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()+1);a.reservation.datum=e.ddmmyyyy()}d.getForDay(a.reservation.datum).success(function(b){a.reservations=b}),a.k=0,a.setTable=function(b,c,d){a.k++;return a.k%2===0?!0:void(d?b!=c?a.reservation.table=c:b===c&&delete a.reservation.table:delete a.reservation.table)},a.reservedTable=function(){angular.forEach(a.availability,function(c){return a.reservation.table===c.table._id&&c.free?(b=!0,0):void 0})},a.updateTables=function(b,c){angular.forEach(c,function(c,d){b!=d&&(c.checked=!1,a.reservation.tableNum=b)})},a.changeTime=function(){(!a.reservation.endTime||parseInt(a.reservation.endTime)<=parseInt(a.reservation.startTime))&&(a.reservation.endTime=(parseInt(a.reservation.startTime)+1).toString())},a.checkendTime=function(){var b=parseInt(a.reservation.startTime),c=parseInt(a.reservation.endTime);b>=c&&(b=c-1,a.reservation.startTime=b.toString())},a.checkAvailability=function(){angular.forEach(a.availability,function(a){a.free=!0}),angular.forEach(a.availability,function(b){angular.forEach(a.reservations,function(c){if(b.table._id===c.table){var d=new Date(c.startDate),e=new Date(c.endDate);(a.reservation.startTime>=d.getHours()&&a.reservation.startTime<e.getHours()||a.reservation.endTime>d.getHours()&&a.reservation.endTime<=e.getHours()||a.reservation.startTime<=d.getHours()&&a.reservation.endTime>=e.getHours())&&(b.free=!1)}})})},a.$watch("reservation.datum",function(){console.log(a.reservation.datum),d.getForDay(a.reservation.datum).success(function(b){a.reservations=b,""!==a.reservation.startTime&&a.checkAvailability()}),angular.forEach(a.availability,function(a){a.checked=!1})},!0),a.$watch("reservation.startTime",function(){a.checkAvailability()}),a.$watch("reservation.endTime",function(){a.checkAvailability()}),a.sendReservation=function(b){if(""===a.reservation.table||!a.reservation.table)return a.message="* Vyberte stůl",0;var c=b.datum.split("."),e=new Date(c[2],c[1]-1,c[0],b.startTime),f=new Date(c[2],c[1]-1,c[0],b.endTime);d.createReservation(b,e,f).success(function(b,c){delete a.reservation.startTime,delete a.reservation.endTime,delete a.reservation.jmeno,delete a.reservation.prijmeni,delete a.reservation.tel,delete a.reservation.email,delete a.reservation.table,delete a.message,angular.forEach(a.availability,function(a){a.checked=!1}),a.prijataRezervace=!0})}}]),angular.module("veganapp.public").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("public",{url:"",views:{main:{templateUrl:"/views/public/content.html",controller:"headCtrlP"}},"abstract":!0}).state("public.home",{url:"/home",views:{"public":{templateUrl:"/views/public/home.html",controller:"homeCtrl"}}}).state("public.menu",{url:"/menu",views:{"public":{templateUrl:"/views/public/menu.html",controller:"menuCtrlP"}}}).state("public.contact",{url:"/contact",views:{"public":{templateUrl:"/views/public/contact.html",controller:"contactCtrl"}}}).state("public.reservation",{url:"/reservation",views:{"public":{templateUrl:"/views/public/tables.html",controller:"tablesCtrl"}}})}]).run(["$rootScope","$state",function(a,b){a.$state=b,b.go("public.home")}]),angular.module("veganapp.public").controller("headCtrlP",["$scope","$http","$rootScope","$window",function(a,b,c,d){!function(){var a=angular.element(document.getElementsByTagName("body")),b=[],c=function(a){angular.forEach(["$scope","$isolateScope"],function(c){a.data()&&a.data().hasOwnProperty(c)&&angular.forEach(a.data()[c].$$watchers,function(a){b.push(a)})}),angular.forEach(a.children(),function(a){c(angular.element(a))})};c(a);var d=[];angular.forEach(b,function(a){d.indexOf(a)<0&&d.push(a)}),console.log(d.length)}(),a.winSize=d.innerWidth,a.resizeWin=function(){d.innerWidth<768?(a.showLeftMenu=!1,a.classSmallScreen="smallScreen"):(a.showLeftMenu=!0,a.classSmallScreen="")},a.resizeWin(),$(window).resize(function(){a.$apply(function(){a.resizeWin(),a.winSize=d.innerWidth})})}]),angular.module("veganapp.admin").factory("authProvider",["$q","$timeout","$http","$location",function(a,b,c,d){return{login:function(a,b){return c.post("/api/login",{username:a,password:b}).success(function(a,b){return a}).error(function(){return 0})},isLoggedIn:function(){return c.get("/api/logged").success(function(a,b){return a}).error(function(){return 0})},logout:function(){return c.get("/api/logout").success(function(a,b){return a}).error(function(){return 0})}}}]),angular.module("veganapp").factory("dailyMenuFactory",function(a){return{getDailyMenu:function(){return a.get("/api/dailymenu").success(function(a){this.jsonData=a})},getDay:function(){return a.get("/api/dailymenu/day").success(function(a){this.jsonData=a})},getType:function(){return a.get("/api/dailymenu/type").success(function(a){this.jsonData=a})},getSort:function(){return a.get("/api/dailymenu/sort").success(function(a){this.jsonData=a})},getById:function(b){return a.get("/api/dailymenu/id/"+b).success(function(a){this.jsonData=a})},createFood:function(b){return a.post("/api/dailymenu",{foodName:b.jmeno,foodDescription:b.popis,foodType:b.typ,foodSort:b.trida,price:b.cena,day:b.den})},editFood:function(b,c){return a.put("/api/dailymenu/"+c,{foodName:b.jmeno,foodDescription:b.popis,foodType:b.typ,foodSort:b.trida,price:b.cena,day:b.den})},removeFood:function(b){return a["delete"]("/api/dailymenu/"+b,{id:b})}}}),angular.module("veganapp").factory("drinkMenu",["$http",function(a){return{getDrinks:function(){return a.get("/api/drinkmenu").success(function(a){this.jsonData=a})},createDrink:function(b){return a.post("/api/drinkmenu",{drinkName:b.jmeno,drinkDescription:b.popis,drinkType:b.typ,drinkSort:b.trida,price:b.cena,volume:b.objem})},removeDrink:function(b){return a["delete"]("/api/drinkmenu/"+b,{id:b})},updateDrink:function(b,c){return a.put("/api/drinkmenu/"+c,{id:c,drinkName:b.jmeno,drinkDescription:b.popis,drinkSort:b.trida,price:b.cena,volume:b.objem})},getById:function(b){return a.get("/api/drinkmenu/id/"+b,{id:b}).success(function(a){this.jsonData=a})},getSort:function(){return a.get("/api/drinkmenu/sort").success(function(a){this.jsonData=a})}}}]),angular.module("veganapp").factory("menuFactory",function(a){return{getFood:function(){return a.get("/api/menu")},getSort:function(){return a.get("/api/menu/sort").success(function(a){this.jsonData=a})},getTyp:function(){return a.get("/api/menu/type").success(function(a){this.jsonData=a})},createFood:function(b){return a.post("/api/menu",{foodName:b.jmeno,foodDescription:b.popis,foodType:b.typ,foodSort:b.trida,price:b.cena})},removeFood:function(b){return a["delete"]("/api/menu/"+b,{id:b})},updateFood:function(b,c){return a.put("/api/menu/"+b,{id:b,foodName:c.jmeno,foodDescription:c.popis,foodType:c.typ,foodSort:c.trida,price:c.cena})}}}),angular.module("veganapp").factory("reservationFactory",["$http",function(a){return{getReservations:function(){return a.get("/api/reservation").success(function(a){this.jsonData=a})},getForDay:function(b){return a.get("/api/reservation/"+b)},createReservation:function(b,c,d){return a.post("/api/reservation",{jmeno:b.jmeno,prijmeni:b.prijmeni,tableId:b.table,email:b.email,tel:b.tel,startDate:c,endDate:d})},deleteReservation:function(b){return a["delete"]("/api/reservation/"+b)},updateReservation:function(b,c,d){return a.put("/api/reservation",{jmeno:b.jmeno,prijmeni:b.prijmeni,tableId:b.table,email:b.email,tel:b.tel,startDate:c,endDate:d})}}}]),angular.module("veganapp").factory("tablesFactory",function(a){return{getTables:function(){return a.get("/api/table").success(function(a){this.jsonTables=a})},getTableById:function(b){return a.get("/api/table/"+b).success(function(a){this.jsonTables=a})}}}),angular.module("veganapp.admin").factory("userFactory",function(a){return{getUserById:function(b){return a.get("/api/user/"+b,{id:b}).success(function(a){this.jsonData=a})},getAllUsers:function(){return a.get("/api/user").success(function(a){this.jsonData=a})},createUser:function(b){return a.post("/api/user",{username:b.uzivJm,name:b.jm,surname:b.prijm,role:b.role,email:b.email,phone:b.phone})},deleteUser:function(b){return a["delete"]("/api/user/"+b,{id:b})},updateUser:function(b,c){return a.put("/api/user/"+b,{id:b,username:c.uzivJm,name:c.jm,surname:c.prijm,role:c.role,email:c.email,phone:c.phone,emailMessage:c.emailMTmp,password:c.password})}}}),angular.module("veganapp.system",["ui.router","ui.router.stateHelper","ui.bootstrap","ngRoute","angularjs-datetime-picker"]);var mongoose=require("mongoose"),config=require("./config"),mongoURI=process.env.MONGODB_URI||config.mongoose.uri,dbMongo=mongoose.createConnection(mongoURI);dbMongo.on("error",console.error),dbMongo.once("open",function(){console.log("Connected to database")}),module.exports=dbMongo;var nconf=require("nconf"),path=require("path");nconf.argv().env().file({file:path.join(__dirname,"config.json")}),module.exports=nconf;var mongoose=require("mongoose"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,connection=require("../config/database"),userSchema=require("../models/user"),User=connection.model("User",userSchema);config=require("./config"),module.exports=function(a){a.serializeUser(function(a,b){b(null,a.id)}),a.deserializeUser(function(a,b){User.findById(a,function(a,c){b(a,c)})}),a.use(new LocalStrategy({username:"username",password:"password"},function(a,b,c){User.findOne({username:a},function(a,d){return a?(console.log("Chyba: local strategy"),c(a)):d?d.password!==b?c(null,!1,{message:"Incorrect password"}):c(null,d):c(null,!1,{message:"Incorrect username"})})}))};var index=require("../controllers/index"),admin=require("../controllers/admin"),menu=require("../controllers/menu"),users=require("../controllers/user"),tables=require("../controllers/table"),dailyMenu=require("../controllers/dailyMenu"),drinks=require("../controllers/drinkMenu"),reservation=require("../controllers/reservation"),auth=require("../controllers/authenticate"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy;module.exports=function(a,b){a.get("/",index.render),a.get("/api/menu",menu.findAll),a.post("/api/menu",menu.createFood),a.get("/api/menu/type",menu.enumType),a.get("/api/menu/sort",menu.enumSort),a.put("/api/menu/:id",menu.editFood),a["delete"]("/api/menu/:id",menu.deleteFood),a.get("/api/drinkmenu",drinks.findAll),a.get("/api/drinkmenu/sort",drinks.enumSort),a.get("/api/drinkmenu/id/:id",drinks.getById),a.put("/api/drinkmenu/:id",drinks.editDrink),a.post("/api/drinkmenu",drinks.createDrink),a["delete"]("/api/drinkmenu/:id",drinks.deleteDrink),a.get("/api/dailymenu",dailyMenu.findAll),a.get("/api/dailymenu/id/:id",dailyMenu.findById),a.get("/api/dailymenu/day",dailyMenu.enumDay),a.get("/api/dailymenu/type",dailyMenu.enumType),a.get("/api/dailymenu/sort",dailyMenu.enumSort),a.put("/api/dailymenu/:id",dailyMenu.editFood),a["delete"]("/api/dailymenu/:id",dailyMenu.deleteFood),a.post("/api/dailymenu",dailyMenu.createFood),a.get("/api/user",auth.checkAuthenticate,users.findAll),a.get("/api/user/:id",users.findUserById),a.post("/api/user",users.createUser),a.put("/api/user/:id",users.editUser),a["delete"]("/api/user/:id",users.deleteUser),a.get("/api/table",tables.findAll),a.get("/api/table/:id",tables.findById),a.get("/api/reservation",auth.checkAuthenticate,reservation.findAll),a.get("/api/reservation/:date",reservation.findForDay),a.post("/api/reservation",reservation.createReservation),a["delete"]("/api/reservation/:id",reservation.deleteReservation),a.put("/api/reservation/:id",reservation.editReservation),a.post("/api/login",b.authenticate("local"),auth.login),a.get("/api/logged",auth.logged),a.get("/api/logout",auth.logout)};var User=require("../models/user");exports.render=function(a,b,c){b.render("admin",{title:"Vegan Restaurant"})};var local=require("passport-local").Strategy,passport=require("passport");exports.login=function(a,b){b.send(a.body)},exports.logout=function(a,b){a.logout(),b.redirect("/")},exports.checkAuthenticate=function(a,b,c){a.isAuthenticated()?c():b.render("404")},exports.logged=function(a,b){a.isAuthenticated()?b.send(a.session.passport.user):b.sendStatus(401)};var connection=require("../config/database"),dailyMenuSchema=require("../models/dailyMenu");DailyMenu=connection.model("DailyMenu",dailyMenuSchema),exports.findAll=function(a,b,c){DailyMenu.find(function(a,c){a&&b.send(a),b.json(c)})},exports.findById=function(a,b){DailyMenu.findById(a.params.id,function(a,c){a?b.send(a):b.json(c)})},exports.enumDay=function(a,b){var c=DailyMenu.schema.path("day").enumValues;b.send(JSON.stringify(c))},exports.enumSort=function(a,b){var c=DailyMenu.schema.path("foodSort").enumValues;b.send(JSON.stringify(c))},exports.enumType=function(a,b){var c=DailyMenu.schema.path("foodType").enumValues;b.send(JSON.stringify(c))},exports.editFood=function(a,b){DailyMenu.findByIdAndUpdate(a.params.id,{$set:a.body},function(a,c){a&&(console.log(a),b.send(a))})},exports.deleteFood=function(a,b){DailyMenu.findByIdAndRemove(a.params.id,function(a,c){a?b.send(a):DailyMenu.find(function(a,c){a&&b.send(a),b.json(c)})})},exports.createFood=function(a,b){var c=Number(a.body.price),d=DailyMenu({foodName:a.body.foodName,foodDescription:a.body.foodDescription,foodType:a.body.foodType,foodSort:a.body.foodSort,day:a.body.day,price:c});d.save(function(a,c){a?b.send(a):DailyMenu.find(function(a,c){a&&b.send(a),b.json(c)})})};var connection=require("../config/database"),drinkMenuSchema=require("../models/drinkMenu");Drink=connection.model("Drink",drinkMenuSchema),exports.findAll=function(a,b,c){FindAll(b)},exports.getById=function(a,b){
Drink.findById(a.params.id,function(a,c){a?b.send(a):b.json(c)})},exports.createDrink=function(a,b){var c=Drink({drinkName:a.body.drinkName,drinkDescription:a.body.drinkDescription,drinkSort:a.body.drinkSort,price:a.body.price,volume:a.body.volume});c.save(function(a,c){a?b.send(a):FindAll(b)})},exports.deleteDrink=function(a,b){Drink.findByIdAndRemove(a.params.id,function(a){a?b.send(a):FindAll(b)})},exports.editDrink=function(a,b){Drink.findByIdAndUpdate(a.body.id,{$set:a.body},function(a){a?b.send(a):FindAll(b)})},exports.enumSort=function(a,b,c){var d=Drink.schema.path("drinkSort").enumValues;b.send(JSON.stringify(d))};var Menu=require("../models/menu");exports.render=function(a,b,c){b.render("index",{title:"Vegan Restaurant"})};var connection=require("../config/database"),menuSchema=require("../models/menu");Menu=connection.model("Menu",menuSchema),exports.findAll=function(a,b,c){findAllFunc(b)},exports.createFood=function(a,b,c){var d=Number(a.body.price),e=Menu({foodName:a.body.foodName,foodDescription:a.body.foodDescription,foodType:a.body.foodType,foodSort:a.body.foodSort,price:d});e.save(function(a,c){a&&b.send(a),findAllFunc(b)})},exports.enumType=function(a,b,c){var d=Menu.schema.path("foodType").enumValues;b.send(JSON.stringify(d))},exports.enumSort=function(a,b,c){var d=Menu.schema.path("foodSort").enumValues;b.send(JSON.stringify(d))},exports.deleteFood=function(a,b,c){Menu.findByIdAndRemove(a.params.id,function(a){a&&b.send(a)})},exports.editFood=function(a,b){Menu.findByIdAndUpdate(a.body.id,{$set:a.body},function(a,c){a&&b.send(a)})};var connection=require("../config/database"),resSchema=require("../models/reservation"),Reservation=connection.model("Reservation",resSchema);Date.prototype.ddmmyyyy=function(){var a=this.getDate(),b=parseInt(this.getMonth())+1,c=this.getFullYear();return 10>b&&(b="0"+b),10>a&&(a="0"+a),[a,".",b,".",c].join("")},exports.createReservation=function(a,b){var c=Number(a.body.tel),d=Reservation({startDate:a.body.startDate,endDate:a.body.endDate,table:a.body.tableId,name:a.body.jmeno,surname:a.body.prijmeni,email:a.body.email,phone:c});d.save(function(a,c){a?b.sendStatus(400):b.sendStatus(200)})},exports.findAll=function(a,b){Reservation.find(function(a,c){a&&b.send(a),b.json(c)})},exports.findForDay=function(a,b){var c=[];Reservation.find(function(d,e){d&&b.send(d);for(var f=0;f<e.length;f++)e[f].startDate.ddmmyyyy()===a.params.date&&c.push(e[f]);b.send(c)})},exports.deleteReservation=function(a,b){Reservation.findByIdAndRemove(a.params.id,function(a){a&&b.send(a)})},exports.editReservation=function(a,b){Reservation.findByIdAndUpdate(a.params.id,{$set:a.body},function(a){a&&b.send(a)})};var connection=require("../config/database"),tableSchema=require("../models/table");Table=connection.model("Table",tableSchema),exports.findAll=function(a,b,c){Table.find(function(a,c){a&&b.send(a),b.json(c)})},exports.findById=function(a,b){Table.findById(a.params.id,function(a,c){a&&b.send(a),b.json(c)})};var connection=require("../config/database"),userSchema=require("../models/user"),User=connection.model("User",userSchema),nodemailer=require("nodemailer"),smtpTransport=require("nodemailer-smtp-transport");exports.findAll=function(a,b,c){User.find(function(a,c){a&&b.send(a),b.json(c)})},exports.findUserById=function(a,b){User.findById(a.params.id,function(a,c){a?b.send(a):b.json(c)})},exports.createUser=function(a,b){var c=randomPassword(),d="Uživatelské jméno: "+a.body.username+"\nHeslo: "+c;d+="\nPřejít do administračního rozhraní: http://localhost:3000/#/login";var e=User({username:a.body.username,name:a.body.name,surname:a.body.surname,role:a.body.role,email:a.body.email,phone:a.body.phone,password:c,emailMessage:!0}),f=nodemailer.createTransport(smtpTransport({service:"gmail",auth:{user:"veganskarestaurace@gmail.com",pass:"veganThesis"}})),g={from:"vegan@restaurant.cz",to:a.body.email,subject:"Přístup do administračního rozhraní",text:d};f.sendMail(g,function(a,b){}),e.save(function(a,c){a?b.send(a):User.find(function(a,c){a&&b.send(a),b.json(c)})})},exports.deleteUser=function(a,b){User.findByIdAndRemove(a.params.id,function(a){a&&b.send(a)})},exports.editUser=function(a,b){User.findByIdAndUpdate(a.params.id,{$set:a.body},function(a,c){a&&b.send(a),b.json(c)})};var mongoose=require("mongoose"),connection=require("../config/database"),dailyMenuSchema=new mongoose.Schema({foodName:{type:String,unique:!1,required:!0},foodDescription:{type:String,required:!0},foodType:{type:String,required:!0,"enum":["vegan","raw"]},foodSort:{type:String,required:!0,"enum":["polevka","hlavni"]},day:{type:String,required:!0,"enum":["pondeli","utery","streda","ctvrtek","patek"]},price:{type:Number,required:!0}});module.exports=dailyMenuSchema;var mongoose=require("mongoose"),connection=require("../config/database"),drinkMenuSchema=new mongoose.Schema({drinkName:{type:String,unique:!0,required:!0},drinkDescription:{type:String,required:!0},drinkSort:{type:String,required:!0,"enum":["caj","kava","fresh","ostatni"]},price:{type:Number,required:!0},volume:{type:String,required:!0}});module.exports=drinkMenuSchema;var mongoose=require("mongoose"),connection=require("../config/database"),menuSchema=new mongoose.Schema({foodName:{type:String,unique:!0,required:!0},foodDescription:{type:String,required:!1},foodType:{type:String,required:!0,"enum":["vegan","raw"]},foodSort:{type:String,required:!0,"enum":["predkrm","hlavni","salat","dezert"]},price:{type:Number,required:!0}});module.exports=menuSchema;var mongoose=require("mongoose"),connection=require("../config/database"),Schema=mongoose.Schema,ObjectId=Schema.ObjectId,reservationSchema=new mongoose.Schema({startDate:{type:Date,required:!0},endDate:{type:Date,required:!0},table:{type:ObjectId,required:!0},name:{type:String,required:!0},surname:{type:String,required:!0},email:{type:String,required:!1},phone:{type:Number,required:!0}});module.exports=reservationSchema;var mongoose=require("mongoose"),connection=require("../config/database"),tableSchema=new mongoose.Schema({name:{type:Number,required:!0,unique:!0},seatingNum:{type:String,required:!0,"enum":["two","four","six"]}});module.exports=tableSchema;var mongoose=require("mongoose"),connection=require("../config/database"),userSchema=new mongoose.Schema({username:{type:String,unique:!0,required:!0},name:{type:String,required:!0},surname:{type:String,required:!0},role:{type:String,required:!0,"enum":["admin","employee"]},password:{type:String,required:!0},email:{type:String,required:!1},emailMessage:{type:Boolean,required:!0},phone:{type:Number,required:!1},created:{type:Date,"default":Date.now}});module.exports=userSchema;